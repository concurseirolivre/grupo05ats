<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simula√ß√£o ATS - Grupo 5</title>
    <style>
        /* --- GERAL --- */
        body {
            background-color: #050505;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* FUNDOS */
        .background-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: -5;
            transition: all 1s ease;
        }
        
        .bg-prologue {
            filter: brightness(0.4) contrast(1.1);
            transition: background-image 0.5s ease;
        }
        
        .bg-game {
            background-image: url('img1.jpg'); 
            filter: brightness(0.3) contrast(1.2) blur(2px);
        }

        /* EFEITOS VISUAIS */
        #disaster-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 900;
            display: none;
        }

        /* Flash do Raio */
        #lightning-flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 901; opacity: 0; pointer-events: none;
        }

        .rain {
            position: absolute;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0.5));
            width: 2px; height: 50px; top: -60px; border-radius: 2px; pointer-events: none;
        }
        /* Chuva JS */
        .rain-js {
            position: absolute;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0.6));
            width: 2px; height: 60px; top: -60px; border-radius: 2px; pointer-events: none;
        }

        .fire-particle {
            position: absolute;
            background: radial-gradient(circle, rgba(255,80,0,0.8) 0%, rgba(255,0,0,0) 70%);
            border-radius: 50%; bottom: -50px; pointer-events: none; filter: blur(4px); mix-blend-mode: screen;
        }

        .shake-screen {
            animation: shake 3s cubic-bezier(.36,.07,.19,.97) infinite;
        }

        @keyframes rain-fall { to { transform: translateY(120vh); } }
        @keyframes rise { 
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-80vh) scale(0); opacity: 0; }
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(1px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-2px, 0, 0); }
            40%, 60% { transform: translate3d(2px, 0, 0); }
        }
        @keyframes flash-anim {
            0% { opacity: 0; } 10% { opacity: 0.8; } 20% { opacity: 0; } 100% { opacity: 0; }
        }

        /* --- 1. CAPA --- */
        #cover-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #050505; z-index: 5000;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Arial Black', sans-serif; color: #fff; cursor: pointer;
            transition: opacity 1.5s ease-out;
        }
        .cover-box {
            position: relative; z-index: 10; background: rgba(0, 0, 0, 0.7);
            padding: 40px 60px; border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,1);
            backdrop-filter: blur(3px); text-align: center;
        }
        .cover-box h1 { margin: 0; font-size: 3rem; text-transform: uppercase; letter-spacing: 5px; }
        .cover-box h2 { margin: 5px 0 25px 0; font-size: 1.2rem; color: #ff5252; text-transform: uppercase; letter-spacing: 2px; font-weight: normal; }
        .members { list-style: none; padding: 0; margin: 0; font-family: 'Segoe UI', sans-serif; font-size: 1.1rem; font-weight: 600; color: #cfcfcf; line-height: 1.6; }
        .start-msg { margin-top: 20px; font-size: 0.8rem; color: #888; font-family: monospace; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* --- 2. PR√ìLOGO --- */
        #prologue-container {
            width: 90%; max-width: 900px; background-color: rgba(20, 20, 25, 0.95);
            border: 1px solid #444; border-top: 5px solid #2196F3; border-radius: 8px;
            padding: 40px; box-shadow: 0 0 50px rgba(0, 0, 0, 0.9);
            display: none; flex-direction: column; align-items: center; text-align: center;
            z-index: 1000; animation: fadeIn 1s; position: relative;
        }
        #prologue-title { color: #2196F3; font-size: 1.5em; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; width: 100%; }
        #prologue-text { font-size: 1.3em; line-height: 1.6; min-height: 200px; white-space: pre-wrap; margin-bottom: 30px; text-align: left; color: #fff; }
        .nav-buttons { display: flex; gap: 20px; width: 100%; justify-content: space-between; align-items: center; }
        .btn-prologue { background: transparent; border: 1px solid #2196F3; color: #2196F3; padding: 10px 30px; font-size: 1em; cursor: pointer; transition: all 0.3s; font-family: inherit; }
        .btn-prologue:hover { background: #2196F3; color: white; }

        /* --- 3. TELA DE ABERTURA/ALERTA --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); z-index: 2000;
            display: none; flex-direction: column; align-items: center;
            justify-content: center; text-align: center; opacity: 0;
        }
        #intro-content h1 { color: #ff3d00; font-size: 4em; margin-bottom: 0; text-transform: uppercase; text-shadow: 0 0 20px rgba(255, 61, 0, 0.8); animation: pulse 1.5s infinite; letter-spacing: 5px; }
        #intro-content h2 { color: #fff; font-weight: normal; margin-top: 10px; font-size: 1.5em; }
        #btn-start-simulation { background: transparent; border: 3px solid #ff3d00; color: #ff3d00; padding: 20px 50px; font-size: 1.8em; font-family: inherit; font-weight: bold; cursor: pointer; margin-top: 50px; transition: all 0.3s; text-transform: uppercase; animation: borderPulse 2s infinite; }
        #btn-start-simulation:hover { background-color: #ff3d00; color: #000; box-shadow: 0 0 30px #ff3d00; }

        /* --- 4. TELA DO JOGO --- */
        #game-container {
            width: 80%; max-width: 800px; background-color: rgba(20, 20, 20, 0.95);
            border: 1px solid #444; border-left: 5px solid #d32f2f; border-radius: 8px;
            padding: 40px; box-shadow: 0 0 30px rgba(0, 0, 0, 0.8); min-height: 400px;
            display: none; flex-direction: column; opacity: 0; z-index: 500; position: relative;
        }
        .header { border-bottom: 1px solid #555; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; font-size: 0.9em; color: #888; }
        .status-blink { color: #d32f2f; font-weight: bold; animation: blink 1s infinite; }
        #story-text { font-size: 1.2em; line-height: 1.6; white-space: pre-wrap; min-height: 100px; }
        #feedback-area { margin-bottom: 20px; font-weight: bold; padding: 15px; border-radius: 4px; display: none; font-size: 1.1em; }
        .feedback-success { background-color: rgba(46, 125, 50, 0.2); border: 1px solid #2e7d32; color: #81c784; }
        .feedback-error { background-color: rgba(198, 40, 40, 0.2); border: 1px solid #c62828; color: #e57373; }
        .choices { display: flex; flex-direction: column; gap: 10px; margin-top: 30px; opacity: 0; transition: opacity 1s; }
        .btn { background: transparent; border: 1px dashed #FFEB3B; color: #FFEB3B; padding: 15px; text-align: left; font-family: inherit; font-size: 1.1em; cursor: pointer; transition: all 0.2s; }
        .btn:hover { background-color: #FFEB3B; color: #000; border-style: solid; transform: translateX(5px); }
        .cursor { display: inline-block; width: 10px; height: 1em; background-color: #0f0; animation: blink 1s infinite; vertical-align: bottom; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes borderPulse { 0% { box-shadow: 0 0 0 0 rgba(255, 61, 0, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 61, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 61, 0, 0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="background-fixed bg-prologue" id="main-bg"></div>
    
    <div id="disaster-layer"></div>
    <div id="lightning-flash"></div>

    <audio id="audio-prologue" preload="auto"></audio>
    <audio id="audio-news" src="audio.mp3" preload="auto"></audio> <audio id="audio-game" preload="auto"></audio> <div id="cover-screen">
        <div class="rain-back"></div><div class="rain-front"></div><div class="bolt"></div><div class="flash"></div>
        <div class="cover-box">
            <h1>GRUPO 05</h1>
            <h2>Cen√°rio: Desastre Ambiental</h2>
            <ul class="members">
                <li>Pedro Cineli</li><li>Alvaro</li><li>Lucas Franklin</li><li>Lucas Barbosa</li><li>Israel</li><li>Renan</li>
            </ul>
            <div class="start-msg">[ CLIQUE PARA INICIAR ]</div>
        </div>
    </div>

    <div id="prologue-container">
        <div id="prologue-title">INTRODU√á√ÉO T√âCNICA</div>
        <div id="prologue-text"></div>
        <div class="nav-buttons">
            <button class="btn-prologue" id="btn-prev-prologue" style="visibility: hidden;">Anterior</button>
            <button class="btn-prologue" id="btn-play-pause" style="min-width: 160px;">‚ñ∂Ô∏è Play</button>
            <button class="btn-prologue" id="btn-next-prologue">Pr√≥ximo ‚ûú</button>
        </div>
    </div>

    <div id="intro-screen">
        <div id="intro-content">
            <h1>ATEN√á√ÉO</h1>
            <h2>SITUA√á√ÉO DE DESASTRE EM ANDAMENTO</h2>
            <h2>A√á√ÉO IMEDIATA NECESS√ÅRIA</h2>
            <button id="btn-start-simulation">INICIAR OPERA√á√ÉO</button>
        </div>
    </div>

    <div id="game-container">
        <div class="header">
            <span>SALA DE SITUA√á√ÉO: GRUPO 5</span>
            <span class="status-blink">‚óè AO VIVO - PETR√ìPOLIS</span>
        </div>
        <div id="feedback-area"></div>
        <div id="text-container"><span id="story-text"></span><span class="cursor"></span></div>
        <div id="choices-container" class="choices"></div>
    </div>

<script>
    // --- VARI√ÅVEIS ---
    const coverScreen = document.getElementById('cover-screen');
    const prologueContainer = document.getElementById('prologue-container');
    const introScreen = document.getElementById('intro-screen');
    const gameContainer = document.getElementById('game-container');
    const mainBg = document.getElementById('main-bg');
    const disasterLayer = document.getElementById('disaster-layer');
    const lightningFlash = document.getElementById('lightning-flash');
    
    const audioPrologue = document.getElementById('audio-prologue');
    const audioNews = document.getElementById('audio-news'); // Esse √© o audio.mp3
    const btnPlayPause = document.getElementById('btn-play-pause');
    const btnNext = document.getElementById('btn-next-prologue');
    const btnPrev = document.getElementById('btn-prev-prologue');
    const btnStartSim = document.getElementById('btn-start-simulation');

    let currentPrologueIndex = 0;
    let disasterInterval;
    let lightningInterval;

    // --- EFEITOS VISUAIS ---
    function triggerLightning() {
        lightningFlash.style.animation = 'none';
        lightningFlash.offsetHeight; 
        lightningFlash.style.animation = 'flash-anim 0.3s ease-out';
        if (gameContainer.style.display === 'flex') {
            gameContainer.classList.remove('shake-screen');
            void gameContainer.offsetWidth; 
            gameContainer.classList.add('shake-screen');
        }
    }

    function startDisasterEffect(type) {
        disasterLayer.style.display = 'block';
        disasterLayer.innerHTML = '';
        clearInterval(disasterInterval);
        clearInterval(lightningInterval);

        if (type === 'rain' || type === 'storm') {
            disasterInterval = setInterval(() => {
                for(let i=0; i<4; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain-js';
                    drop.style.left = Math.random() * 100 + 'vw';
                    drop.style.height = (Math.random() * 20 + 30) + 'px';
                    drop.style.animation = `rain-fall ${Math.random() * 0.3 + 0.5}s linear`;
                    disasterLayer.appendChild(drop);
                    setTimeout(() => { drop.remove(); }, 1000);
                }
            }, 50);
            if (type === 'storm') {
                lightningInterval = setInterval(() => {
                    if(Math.random() > 0.6) triggerLightning();
                }, 3000); 
            }
        } else if (type === 'fire') {
            disasterInterval = setInterval(() => {
                for(let i=0; i<3; i++) {
                    const e = document.createElement('div');
                    e.className = 'fire-particle';
                    e.style.left = Math.random() * 100 + 'vw';
                    e.style.width = (Math.random() * 20 + 5) + 'px';
                    e.style.height = e.style.width;
                    const c = Math.random() > 0.5 ? 'rgba(255,80,0,0.8)' : 'rgba(255,200,0,0.6)';
                    e.style.background = `radial-gradient(circle, ${c} 0%, rgba(255,0,0,0) 70%)`;
                    e.style.animation = `rise ${Math.random() * 1.5 + 1}s ease-out forwards`;
                    disasterLayer.appendChild(e);
                    setTimeout(() => { e.remove(); }, 2500);
                }
            }, 80);
        }
    }

    function stopDisasterEffect() {
        clearInterval(disasterInterval);
        clearInterval(lightningInterval);
        disasterLayer.innerHTML = '';
        disasterLayer.style.display = 'none';
    }

    // --- DADOS DO PR√ìLOGO (Sem Audio 1 para exemplo) ---
    const prologueData = [
        { title: "IN√çCIO", text: "\"Quando um desastre acontece...\"", img: "https://www.pragmatismopolitico.com.br/wp-content/uploads/2018/05/acidente-cuba-e1527030296940.jpg", effectType: 'rain' },
        { title: "O PAPEL DO M√âDICO", text: "\"Um desastre √© qualquer evento...\"", img: "https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?auto=format&fit=crop&w=1920&q=80" },
        { title: "TRIAGEM", text: "\"A triagem √© o cora√ß√£o...\"", img: "https://images.unsplash.com/photo-1516574187841-69301976e49e?auto=format&fit=crop&w=1920&q=80" },
        { title: "SITUA√á√ïES SIMPLES", text: "\"A maioria das demandas...\"", img: "https://www.saude.sp.gov.br/resources/hospital-leonor-mendes-de-barros/acesso-rapido/primeiros-socorros-em-caso-de-incendio.jpg" },
        { title: "ALTA COMPLEXIDADE", text: "\"Em outros cen√°rios...\"", img: "https://ogimg.infoglobo.com.br/in/23946251-8e9-d10/FT1086A/GettyImages-56441651.jpg", effectType: 'fire' },
        { title: "LOG√çSTICA", text: "\"O m√©dico coordena...\"", img: "https://cdn.folhape.com.br/img/c/1200/900/dn_arquivo/2020/01/medico1.jpg" },
        { title: "A ESS√äNCIA", text: "\"No fim, atuar em um desastre...\"", img: "https://blog.unyleyamed.com.br/wp-content/uploads/2023/09/shutterstock_661890763-scaled.webp" }
    ];

    // --- CONTROLE DE FLUXO ---
    
    // 1. TRANSI√á√ÉO CAPA -> PR√ìLOGO
    coverScreen.addEventListener('click', () => {
        coverScreen.style.opacity = '0';
        setTimeout(() => {
            coverScreen.style.display = 'none';
            mainBg.style.display = 'block';
            prologueContainer.style.display = 'flex';
            updatePrologue();
            // Libera os √°udios no navegador
            audioPrologue.play().catch(()=>{}); audioPrologue.pause();
            audioNews.play().catch(()=>{}); audioNews.pause();
        }, 1500);
    });

    // 2. L√ìGICA DO PR√ìLOGO
    function updatePrologue() {
        const data = prologueData[currentPrologueIndex];
        document.getElementById('prologue-title').innerText = data.title;
        document.getElementById('prologue-text').innerText = data.text;
        mainBg.style.backgroundImage = `url('${data.img}')`;
        mainBg.className = "background-fixed bg-prologue";

        if (data.effectType) startDisasterEffect(data.effectType); else stopDisasterEffect();

        btnPrev.style.visibility = currentPrologueIndex === 0 ? 'hidden' : 'visible';
        if (currentPrologueIndex === prologueData.length - 1) {
            btnNext.innerText = "IR PARA A√á√ÉO ‚ö†";
            btnNext.style.borderColor = "#ff3d00";
            btnNext.style.color = "#ff3d00";
        } else {
            btnNext.innerText = "Pr√≥ximo ‚ûú";
            btnNext.style.borderColor = "#2196F3";
            btnNext.style.color = "#2196F3";
        }

        // Reseta Audio do Slide
        audioPrologue.pause();
        btnPlayPause.innerText = "‚ñ∂Ô∏è Play";
        // Se tivesse arquivo de audio especifico para o slide, carregaria aqui
        // audioPrologue.src = data.audio;
    }

    btnNext.addEventListener('click', () => {
        if (currentPrologueIndex < prologueData.length - 1) {
            currentPrologueIndex++;
            updatePrologue();
        } else {
            // FIM DO PR√ìLOGO -> TELA DE ALERTA
            // AQUI TOCA O √ÅUDIO DA NOT√çCIA (audio.mp3) IMEDIATAMENTE
            audioPrologue.pause();
            stopDisasterEffect();
            
            audioNews.currentTime = 0;
            audioNews.play().catch(e => console.log(e));

            prologueContainer.style.display = 'none';
            mainBg.style.backgroundImage = "url('img1.jpg')";
            mainBg.className = "background-fixed bg-game";
            introScreen.style.display = 'flex';
            setTimeout(() => { introScreen.style.opacity = '1'; }, 50);
        }
    });

    btnPrev.addEventListener('click', () => {
        if (currentPrologueIndex > 0) {
            currentPrologueIndex--;
            updatePrologue();
        }
    });

    btnPlayPause.addEventListener('click', () => {
        if (audioPrologue.paused) {
            audioPrologue.play();
            btnPlayPause.innerText = "‚è∏Ô∏è Pausar";
        } else {
            audioPrologue.pause();
            btnPlayPause.innerText = "‚ñ∂Ô∏è Play";
        }
    });


    // 3. TRANSI√á√ÉO ALERTA -> JOGO
    btnStartSim.addEventListener('click', () => {
        // Para a not√≠cia
        audioNews.pause();
        
        // Inicia efeitos do jogo
        startDisasterEffect('storm');

        introScreen.style.transition = "opacity 1s";
        introScreen.style.opacity = '0';

        setTimeout(() => {
            introScreen.style.display = 'none';
            gameContainer.style.display = 'flex';
            setTimeout(() => {
                gameContainer.style.opacity = '1';
                gameContainer.style.animation = 'fadeIn 1s ease-out';
                goTo('start');
            }, 100);
        }, 1000);
    });

    // --- MOTOR DO JOGO ---
    const story = {
        "start": { text: "[06:05] CONEX√ÉO ESTABELECIDA...\n\nO deslizamento acabou de acontecer. Qual sua prioridade?", choices: [{ text: "A - Ir para Zona de Impacto", target: "erro_gestao" }, { text: "B - Focar na Gest√£o", target: "fase_2" }] },
        "erro_gestao": { text: "Voc√™ ficou incomunic√°vel.", feedback: { type: "error", msg: "ERRO DE GEST√ÉO." }, choices: [{ text: "Reiniciar", target: "start" }] },
        "fase_2": { text: "Decis√£o correta.", feedback: { type: "success", msg: "ACERTO." }, choices: [{ text: "A - 100% Impacto", target: "erro_prevencao" }, { text: "B - 70% Impacto / 30% Abrigos", target: "fase_3" }] },
        "erro_prevencao": { text: "Surto nos abrigos.", feedback: { type: "error", msg: "FALHA." }, choices: [{ text: "Tentar Novamente", target: "fase_2" }, { text: "Reiniciar", target: "start" }] },
        "fase_3": { text: "Prioridade de Sa√∫de?", feedback: { type: "success", msg: "ACERTO." }, choices: [{ text: "A - Profilaxia", target: "erro_clinico" }, { text: "B - Causa Raiz", target: "fase_4" }] },
        "erro_clinico": { text: "Enxugando gelo.", feedback: { type: "error", msg: "ERRO." }, choices: [{ text: "Tentar Novamente", target: "fase_3" }] },
        "fase_4": { text: "R√°dio mudo.", feedback: { type: "success", msg: "ACERTO." }, choices: [{ text: "A - Insistir", target: "erro_burocracia" }, { text: "B - Ir ao QG", target: "vitoria" }] },
        "erro_burocracia": { text: "Perdeu tempo.", feedback: { type: "error", msg: "FALHA." }, choices: [{ text: "Tentar Novamente", target: "fase_4" }] },
        "vitoria": { text: "MISS√ÉO CUMPRIDA.", feedback: { type: "success", msg: "SUCESSO." }, choices: [{ text: "Reiniciar", target: "start" }] }
    };

    const textElement = document.getElementById('story-text');
    const choicesContainer = document.getElementById('choices-container');
    const feedbackArea = document.getElementById('feedback-area');
    
    function typeWriter(text, i, fnCallback) {
        if (i < text.length) {
            textElement.innerHTML = text.substring(0, i+1) + '<span class="cursor"></span>';
            setTimeout(() => typeWriter(text, i + 1, fnCallback), 15);
        } else { if (fnCallback) fnCallback(); }
    }

    function goTo(sceneId) {
        const scene = story[sceneId];
        textElement.innerHTML = ""; choicesContainer.innerHTML = ""; choicesContainer.style.opacity = "0"; feedbackArea.style.display = "none";
        if (scene.feedback) {
            feedbackArea.style.display = "block";
            feedbackArea.className = scene.feedback.type === 'success' ? 'feedback-success' : 'feedback-error';
            feedbackArea.innerText = (scene.feedback.type === 'success' ? 'üë®‚Äç‚öïÔ∏èüëç ' : 'üë®‚Äç‚öïÔ∏èüëé ') + scene.feedback.msg;
        }
        typeWriter(scene.text, 0, () => renderButtons(scene.choices));
    }

    function renderButtons(choices) {
        choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.innerText = choice.text; btn.className = 'btn';
            btn.onclick = () => goTo(choice.target);
            choicesContainer.appendChild(btn);
        });
        setTimeout(() => choicesContainer.style.opacity = "1", 100);
    }
</script>
</body>
</html>
